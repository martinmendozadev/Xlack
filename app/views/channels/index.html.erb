<%= turbo_stream_from @active_channel %>
<%= turbo_stream_from "channels_list" %>

<div class="flex h-screen antialiased text-gray-900 bg-white overflow-hidden">

  <div class="flex-shrink-0 w-64 bg-gray-900 flex flex-col">

    <div class="px-4 h-12 flex items-center bg-gray-800 text-white font-bold border-b border-gray-700">
      <%= t("common.app_name") %>
    </div>

    <div class="flex-1 overflow-y-auto py-4 font-sans">

      <div class="mb-6">
        <h3 class="px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 flex justify-between items-center group cursor-pointer hover:text-gray-300">
          <%= t("channels.title") %>
          <%= link_to new_channel_path, data: { turbo_frame: "modal" }, class: "group-hover:block text-lg hover:text-white" do %>
            +
          <% end %>
        </h3>

       <nav class="space-y-1" id="public_channels_list">
          <% @public_channels.each do |channel| %>
            <%= render partial: "channels/channel_link",
                       locals: {
                         channel: channel,
                         active: (@active_channel && channel.id == @active_channel.id)
                       } %>
          <% end %>
        </nav>
      </div>

      <div>
        <h3 class="px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 flex justify-between items-center group cursor-pointer hover:text-gray-300">
          <%= t("channels.direct_messages") %>
          <span class="hidden group-hover:block text-lg">+</span>
        </h3>

        <nav class="space-y-1">
          <% @direct_messages.each do |channel| %>
            <% is_active = (@active_channel && channel.id == @active_channel.id) %>
            <% active_classes = is_active ? "bg-blue-700 text-white" : "text-gray-400 hover:bg-gray-800 hover:text-white" %>

            <%= link_to channel_path(channel), class: "group flex items-center px-4 py-2 text-sm font-medium rounded-md #{active_classes}" do %>
               <%= channel_icon(channel) %>
               <%= channel_display_name(channel) %>
            <% end %>
          <% end %>
        </nav>
      </div>

    </div>

    <div class="p-4 bg-gray-800 border-t border-gray-700">
      <div class="flex items-center">
        <div class="h-8 w-8 rounded bg-gray-600 flex items-center justify-center text-white font-bold text-xs">
          <%= current_user.username[0..1].upcase %>
        </div>
        <div class="ml-3">
          <p class="text-sm font-medium text-white">
            <%= current_user.username %>
          </p>
          <%= button_to t("common.logout"), destroy_user_session_path, method: :delete, class: "text-xs hover:underline text-red-500 hover:text-white cursor-pointer" %>
        </div>
      </div>
    </div>
  </div>

  <div class="flex-1 flex flex-col min-w-0 bg-white">

    <div class="border-b border-gray-200 px-6 py-3 flex justify-between items-center bg-white shadow-sm">
      <div class="flex items-center">
        <h2 class="text-lg font-bold text-gray-800 flex items-center">
          <% if @active_channel %>
            <%= channel_icon(@active_channel) %>
            <%= channel_display_name(@active_channel) %>
          <% else %>
            <%= t("channels.no_active_channel") %>
          <% end %>
        </h2>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto p-6 space-y-6" id="messages">
      <% if @messages.any? %>
      <%= render @messages %>
      <% else %>
        <div class="text-center text-gray-400 mt-10">
          <p><%= t("channels.no_messages") %></p>
        </div>
      <% end %>
    </div>

    <div class="p-4 border-t border-gray-200 bg-gray-50">
      <%= render partial: "messages/form", locals: { channel: @active_channel } %>
    </div>

  </div>

  <turbo-frame id="thread_view"></turbo-frame>
  <turbo-frame id="modal"></turbo-frame>
</div>

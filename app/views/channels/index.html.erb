<%= turbo_stream_from @active_channel %>

<div class="flex h-screen antialiased text-gray-900 bg-white overflow-hidden">

  <div class="flex-1 flex flex-col min-w-0 bg-white">

    <div class="border-b border-gray-200 px-6 py-3 flex justify-between items-center bg-white shadow-sm">
      <div class="flex items-center">
        <h2 class="text-lg font-bold text-gray-800 flex items-center">
          <% if @active_channel %>
            <%= channel_icon(@active_channel) %>
            <%= channel_display_name(@active_channel) %>
          <% else %>
            <%= t("channels.no_active_channel") %>
          <% end %>
        </h2>
      </div>
    </div>

  <div class="flex-1 overflow-y-auto p-6 space-y-6"
     id="messages"
     data-controller="scroll">
      <% if @messages.any? %>
        <% current_date = nil %>

      <% @messages.each do |message| %>
        <% message_date = message.created_at.to_date %>

        <% if current_date != message_date %>
          <div class="relative py-4 flex items-center justify-center">
             <div class="absolute inset-0 flex items-center">
                <div class="w-full border-t border-gray-200"></div>
             </div>
             <span class="relative bg-white px-4 text-xs text-gray-500 border border-gray-200 rounded-full">
               <% if message_date == Date.today %>
                 <%= t("channels.today") %>
               <% elsif message_date == Date.yesterday %>
                 <%= t("channels.yesterday") %>
               <% else %>
                 <%= message_date.strftime("%d %b, %Y") %>
               <% end %>
             </span>
          </div>
          <% current_date = message_date %>
        <% end %>

        <%= render message %>
      <% end %>
      <% else %>
        <div id="no_messages_placeholder" class="text-center text-gray-400 mt-10">
          <p><%= t("channels.no_messages") %></p>
        </div>
      <% end %>
    </div>

    <div class="p-4 border-t border-gray-200 bg-gray-50">
      <%= render partial: "messages/form", locals: { channel: @active_channel } %>
    </div>

  </div>

  <turbo-frame id="thread_view"></turbo-frame>
  <turbo-frame id="modal"></turbo-frame>
</div>
